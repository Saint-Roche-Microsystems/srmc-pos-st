<div class="flex-1 p-4 md:p-10 bg-slate-50/50 overflow-y-auto">
    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-end justify-between mb-10 gap-4">
            <div>
                <h1 class="text-4xl font-black text-slate-900 tracking-tight">Stock Inventory</h1>
                <p class="text-slate-500 text-lg">Detailed view of your product catalog and availability.</p>
            </div>
            <div class="flex gap-3">

                <p-button label="New Product" icon="pi pi-plus" severity="primary" (click)="showDialog()"
                    styleClass="rounded-xl px-6 shadow-lg shadow-blue-500/20" />
            </div>
        </div>

        <div
            class="bg-white rounded-[2.5rem] shadow-[0_20px_50px_-12px_rgba(0,0,0,0.05)] border border-slate-100 overflow-hidden">


            <p-table [value]="posService.products()" [tableStyle]="{ 'min-width': '60rem' }"
                styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                    <tr>
                        <th
                            class="bg-white px-6 py-5 text-slate-400 font-bold uppercase tracking-wider text-[11px] border-b border-slate-50">
                            Product Details</th>

                        <th
                            class="bg-white px-6 py-5 text-slate-400 font-bold uppercase tracking-wider text-[11px] border-b border-slate-50 text-right">
                            Price</th>
                        <th
                            class="bg-white px-6 py-5 text-slate-400 font-bold uppercase tracking-wider text-[11px] border-b border-slate-50 text-center">
                            Stock Level</th>
                        <th
                            class="bg-white px-6 py-5 text-slate-400 font-bold uppercase tracking-wider text-[11px] border-b border-slate-50">
                            Status</th>
                        <th
                            class="bg-white px-6 py-5 text-slate-400 font-bold uppercase tracking-wider text-[11px] border-b border-slate-50 text-center">
                            Manage</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-product>
                    <tr class="hover:bg-slate-50/50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-14 h-14 rounded-2xl bg-slate-100 flex-shrink-0 flex items-center justify-center text-slate-400 overflow-hidden shadow-inner border border-white">
                                    @if (product.image) {
                                    <img [src]="product.image" class="w-full h-full object-cover">
                                    } @else {
                                    <i class="pi pi-image text-xl"></i>
                                    }
                                </div>
                                <div>
                                    <span class="block font-bold text-slate-900 leading-tight">{{ product.name }}</span>
                                </div>
                            </div>
                        </td>

                        <td class="px-6 py-4 text-right">
                            <span class="text-lg font-black text-slate-900">{{ product.price | currency }}</span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-col items-center gap-1.5">
                                <div class="w-24 h-2 bg-slate-100 rounded-full overflow-hidden">
                                    <div class="h-full rounded-full transition-all duration-1000"
                                        [style.width.%]="(product.stock / 50) * 100"
                                        [class]="product.stock < 15 ? 'bg-red-500' : 'bg-green-500'"></div>
                                </div>
                                <span class="text-xs font-black" [class.text-red-500]="product.stock < 15">
                                    {{ product.stock }} / 50
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            @if (product.stock > 15) {
                            <div class="flex items-center gap-1.5 text-green-600">
                                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <span class="text-xs font-bold uppercase tracking-tighter">Healthy</span>
                            </div>
                            } @else if (product.stock > 0) {
                            <div class="flex items-center gap-1.5 text-orange-500">
                                <div class="w-2 h-2 rounded-full bg-orange-500"></div>
                                <span class="text-xs font-bold uppercase tracking-tighter">Low Stock</span>
                            </div>
                            } @else {
                            <div class="flex items-center gap-1.5 text-red-600">
                                <div class="w-2 h-2 rounded-full bg-red-500"></div>
                                <span class="text-xs font-bold uppercase tracking-tighter">Out</span>
                            </div>
                            }
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex items-center justify-center gap-1">
                                <p-button icon="pi pi-trash" [text]="true" severity="danger"
                                    (click)="deleteProduct(product.id)"
                                    styleClass="w-9 h-9 rounded-xl hover:bg-red-50" />
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<p-dialog header="Add New Product" [(visible)]="displayDialog" [modal]="true" [style]="{ width: '450px' }"
    styleClass="p-fluid" [draggable]="false" [resizable]="false">
    <form [formGroup]="productForm" class="flex flex-col gap-4 mt-2">
        <div class="field">
            <label for="name" class="block text-sm font-bold text-slate-700 mb-1">Product Name</label>
            <input id="name" type="text" pInputText formControlName="name" placeholder="e.g. Italian Espresso"
                class="w-full p-3 rounded-xl bg-slate-50 border-slate-100 focus:bg-white transition-all" />
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="field">
                <label for="price" class="block text-sm font-bold text-slate-700 mb-1">Price ($)</label>
                <p-inputNumber id="price" formControlName="price" mode="currency" currency="USD" locale="en-US"
                    styleClass="w-full" inputStyleClass="w-full p-3 rounded-xl bg-slate-50 border-slate-100" />
            </div>
            <div class="field">
                <label for="stock" class="block text-sm font-bold text-slate-700 mb-1">Stock Level</label>
                <p-inputNumber id="stock" formControlName="stock" [showButtons]="true" styleClass="w-full"
                    inputStyleClass="w-full p-3 rounded-xl bg-slate-50 border-slate-100" />
            </div>
        </div>

        <div class="field">
            <label for="image" class="block text-sm font-bold text-slate-700 mb-1">Image URL (Optional)</label>
            <input id="image" type="text" pInputText formControlName="image" placeholder="https://..."
                class="w-full p-3 rounded-xl bg-slate-50 border-slate-100 focus:bg-white transition-all" />

            @if (productForm.get('image')?.value) {
            <div class="mt-4 p-2 rounded-2xl bg-slate-50 border border-slate-100 flex flex-col items-center">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Image Preview</span>
                <div class="w-full aspect-video rounded-xl overflow-hidden bg-white border border-slate-100 shadow-sm">
                    <img [src]="productForm.get('image')?.value" class="w-full h-full object-cover"
                        (error)="$any($event.target).src = 'https://placehold.co/400x225?text=Invalid+Image+URL'">
                </div>
            </div>
            }
        </div>

        <div class="flex justify-end gap-3 mt-6">
            <p-button label="Cancel" icon="pi pi-times" [text]="true" severity="secondary"
                (click)="displayDialog = false" />
            <p-button label="Save Product" icon="pi pi-check" severity="primary" (click)="saveProduct()"
                [disabled]="productForm.invalid" styleClass="px-6 rounded-xl shadow-lg shadow-blue-500/20" />
        </div>
    </form>
</p-dialog>
